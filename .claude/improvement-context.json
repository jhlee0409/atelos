{
  "projectName": "ATELOS LLM Control Improvement",
  "version": "1.2.0",
  "lastUpdated": "2025-11-27T02:00:00Z",
  "currentPhase": "P2",
  "currentTask": "P2-3",

  "modelConfig": {
    "targetModel": "gemini-2.5-flash-lite-preview-09-2025",
    "previousModel": "gemini-2.0-flash",
    "appliedSettings": {
      "temperature": 0.5,
      "temperatureEndGame": 0.6,
      "maxTokens": 2000,
      "maxTokensEndGame": 2500,
      "maxTokensUltraLite": 1200
    }
  },

  "phases": {
    "P1": {
      "name": "LLM Control Enhancement",
      "status": "completed",
      "completedAt": "2025-11-27T01:00:00Z",
      "summary": "Model changed to gemini-2.5-flash-lite, prompts enhanced with choice/stat/flag rules, validation strengthened"
    },
    "P2": {
      "name": "Admin Page Enhancement",
      "status": "in_progress",
      "tasks": [
        {
          "id": "P2-1",
          "name": "Add scenarioStats management UI",
          "status": "completed",
          "changes": [
            "Added stat CRUD functions (addStat, updateStat, removeStat, saveStat, editStat)",
            "Added stat management UI with edit/view modes",
            "Added validation for stat ID uniqueness and min/max range"
          ]
        },
        {
          "id": "P2-2",
          "name": "Add triggerCondition field to flags",
          "status": "completed",
          "changes": [
            "Added triggerCondition field to ScenarioFlag type in types/index.ts",
            "Enhanced flag UI with edit/view modes",
            "Added triggerCondition input field with placeholder examples",
            "Added flag type selector (boolean/count)"
          ]
        },
        {
          "id": "P2-3",
          "name": "Improve image upload (blob URL → base64)",
          "status": "pending",
          "file": "pages/admin/ScenarioEditor/BaseContent.tsx, CharacterContent.tsx"
        },
        {
          "id": "P2-4",
          "name": "Unify SystemCondition types",
          "status": "pending",
          "file": "pages/admin/ScenarioEditor/CoreStoryElementsContent.tsx"
        },
        {
          "id": "P2-5",
          "name": "Strengthen scenario validation",
          "status": "pending",
          "file": "lib/validations.ts"
        }
      ]
    },
    "P3": {
      "name": "Game Client Stabilization",
      "status": "pending",
      "tasks": [
        {"id": "P3-1", "name": "Improve action classification logic", "status": "pending"},
        {"id": "P3-2", "name": "Apply HTML escaping (XSS prevention)", "status": "pending"},
        {"id": "P3-3", "name": "Add expected result hints to choices", "status": "pending"},
        {"id": "P3-4", "name": "Transparentize stat amplification", "status": "pending"}
      ]
    }
  },

  "fileChanges": {
    "lib/gemini-client.ts": {
      "status": "modified",
      "phase": "P1"
    },
    "lib/prompt-builder.ts": {
      "status": "modified",
      "phase": "P1"
    },
    "lib/game-ai-client.ts": {
      "status": "modified",
      "phase": "P1"
    },
    "types/index.ts": {
      "status": "modified",
      "phase": "P2",
      "changes": ["Added triggerCondition field to ScenarioFlag type"]
    },
    "pages/admin/ScenarioEditor/SystemRulesContent.tsx": {
      "status": "modified",
      "phase": "P2",
      "changes": [
        "Added complete stat management UI",
        "Enhanced flag management UI with triggerCondition field"
      ]
    }
  },

  "validationRules": {
    "choiceMinLength": 15,
    "choiceMaxLength": 80,
    "koreanRatio": 0.8,
    "maxSingleStatChange": 40,
    "validEndings": ["한다", "이다", "된다", "른다", "ㄴ다"]
  },

  "promptEnhancements": {
    "choiceRules": "Length 15-50 chars, ~한다/~이다 ending, contrast required",
    "statRules": "±5-10 normal, ±10-20 important, ±20-30 extreme, max ±40",
    "flagRules": "9 flags with specific trigger conditions defined"
  },

  "notes": [
    "Phase 1 completed - LLM control significantly improved",
    "P2-1 completed - Stats can now be managed from admin UI",
    "P2-2 completed - Flags now have triggerCondition field for AI guidance",
    "Next: P2-3 Image upload improvement (blob → base64)"
  ]
}
